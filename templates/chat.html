<!DOCTYPE html>
<html>
<head>
    <title>ChatBot con LLM Local</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
    <div class="header">
        <h1>ChatBot con LLM Local</h1>
        <p>Proyecto Final - Docker + IA Local</p>
    </div>
    
    <div class="chat-container" id="chat">
        <div class="message bot">
            ¡Hola! Soy tu chatbot con inteligencia artificial local. 
            ¿En qué puedo ayudarte?
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="input" placeholder="Escribe tu mensaje..." autocomplete="off">
        <button onclick="sendMessage()">Enviar</button>
    </div>
    
    <div class="status" id="status">
        Conectado a LLM local
    </div>

    <script>
        const chat = document.getElementById('chat');
        const input = document.getElementById('input');
        const status = document.getElementById('status');

        async function sendMessage() {
            const message = input.value.trim();
            if (!message) return;

            // Agregar mensaje del usuario
            addMessage(message, 'user');
            input.value = '';
            
            // Mostrar "escribiendo..."
            const typingMsg = addMessage('Escribiendo...', 'bot');
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: message })
                });
                
                const data = await response.json();
                
                // Remover "escribiendo..." y agregar respuesta real
                typingMsg.remove();
                
                if (data.success) {
                    addMessage(data.response, 'bot');
                    status.textContent = '✓ Respuesta recibida';
                } else {
                    addMessage(`Error: ${data.error}`, 'bot');
                    status.textContent = '✗ Error en la respuesta';
                }
                
            } catch (error) {
                typingMsg.remove();
                addMessage('Error de conexión con el servidor', 'bot');
                status.textContent = '✗ Error de conexión';
            }
        }

        function addMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            chat.appendChild(messageDiv);
            chat.scrollTop = chat.scrollHeight;
            return messageDiv;
        }

        // Enviar con Enter
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        // Focus en el input al cargar
        input.focus();
    </script>
</body>
</html>